<!DOCTYPE HTML>
<html>
 <head>
  <title>Flask-SocketIO Test</title>
   <script type="text/javascript" src="//code.jquery.com/jquery-3.2.1.min.js"></script>
   <script type="text/javascript" src="https://code.jquery.com/ui/1.13.1/jquery-ui.min.js"></script>
   <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.1/themes/smoothness/jquery-ui.css">
   <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.5/socket.io.min.js"></script>
   <script type="text/javascript" src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
   <script type="text/javascript" src="//cdn.rawgit.com/Mikhus/canvas-gauges/gh-pages/download/2.1.7/all/gauge.min.js"></script>
   
   <script type="text/javascript">
      $( function() {
        $( "#tabs" ).tabs({
          event: "click"
        });
      } );
    </script>
   <script type="text/javascript">
     $(document).ready(function() {
     
      var x = new Array();
      var y1 = new Array();
      var y2 = new Array();
      var trace1;
      var trace2;
      var layout;
      
      // Gauge
			var gauge = new RadialGauge({
	        renderTo: 'myGauge',
	        width: 300,
	        height: 300,
	        units: "sin",
	        value: 0,
	        minValue: -1,
	        maxValue: 1,
	        majorTicks: [
	            "-1.0",
	            "-0.5",
	            "0.0",
	            "0.5",
	            "1.0"
	        ],
	        minorTicks: 5,
	        strokeTicks: true,
	        highlights: [
	            {
	                "from": 0,
	                "to": 1,
	                "color": "rgba(50, 50, 50, .50)"
	            }
	        ],
	        colorPlate: "#ffff",
	        borderShadowWidth: 0,
	        borders: false,
	        needleType: "arrow",
	        needleWidth: 2,
	        needleCircleSize: 7,
	        needleCircleOuter: true,
	        needleCircleInner: false,
	        animationDuration: 500,
	        animationRule: "linear"
	    });
	    
	    gauge.draw();
      
      namespace = '/test';
      var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port + namespace);

      socket.on('connect', function() {
        socket.emit('my_event', {data: 'I\'m connected!', value: 1}); });

      socket.on('my_response', function(msg) {
        console.log(msg.data);
        $('#log').append('Received #'+msg.count+': '+msg.data+'<br>').html();
        
        // Plot
        if ('x' in msg){
		      x.push(parseFloat(msg.x));
		      y1.push(parseFloat(msg.y1));
		      y2.push(parseFloat(msg.y2));
		      trace1 = {
		          x: x,
		          y: y1,
		          name: 'sin'
		      };
		      trace2 = {
		          x: x,
		          y: y2,
		          name: 'cos'
		      };
		      layout = {
		        title: 'Data',
		        xaxis: {
		            title: 'x',
		        },
		        yaxis: {
		            title: 'y',
		        }
		      };
		      console.log(trace1);
		      var traces = new Array();
		      traces.push(trace1, trace2);
		      Plotly.newPlot($('#myPlot')[0], traces, layout); 
		    };
		  
		    gauge.value = msg.y1;
      
      });
      $('form#emit').submit(function(event) {
          socket.emit('my_event', {value: $('#emit_value').val()});
          return false; });
      $('form#disconnect').submit(function(event) {
          socket.emit('disconnect_request');
          return false; });
      $('form#start').submit(function(event) {
          socket.emit('start');
          return false; });
      $('form#stop').submit(function(event) {
          socket.emit('stop');
          return false; });
      });
      
    </script>
 </head>
 <body>
  <h1>Flask-SocketIO Test</h1>
  
  <div id="tabs">
      <ul>
        <li><a href="#tabs-1">Control</a></li>
        <li><a href="#tabs-2">Plot</a></li>
        <li><a href="#tabs-3">Gauge</a></li>
      </ul>
      <div id="tabs-1">
        
				<h2>Send:</h2>
				<form id="emit" method="POST" action='#'>
					<input type="text" name="emit_value" id="emit_value" placeholder="Amplituda">
					<input type="submit" value="Send">
				</form>
				<form id="disconnect" method="POST" action="#">
					<input type="submit" value="Disconnect">
				</form>
				<form id="start" method="POST" action="#">
					<input type="submit" value="Start">
				</form>
				<form id="stop" method="POST" action="#">
					<input type="submit" value="Stop">
				</form> 
				<h2>Receive:</h2>
				<div id="log"></div>
				
      </div>
      <div id="tabs-2">
  			<div id="myPlot" style="width:100%;max-width:700px;height:100%"></div>
      </div>
      <div id="tabs-3">
  			<canvas id="myGauge"></canvas>
      </div>
    </div>
  
 </body>
</html>
